task pgyer(type: Exec) {

    String apiKey = "***"
    String userKey = "***"
    String desc = ""
    if (descProp == null) {
        desc = getGitLog()
    } else {
        desc = getOtherLog(descProp)
    }
    commandLine 'curl'
    args '-k', 'http://www.pgyer.com/apiv1/app/upload',
            '-F', "uKey=${userKey}",
            '-F', "_api_key=${apiKey}",
            '-F', "file=@${getApkPath()}",
            '-F', "updateDescription=${desc}"
}

def getGitLog() {
    return 'git log --pretty=format:"%s___in___%ad___by___%an" -10 --date=format:%c'.execute().text
}

def getOtherLog(String inject) {
    return "echo $inject".execute().text
}

def getApkPath() {
    String buildType = getBuildType().toLowerCase()
    println buildDir
    return new File(buildDir, "outputs/apk/${buildType}/app-${buildType}.apk").absolutePath
}

def getBuildType() {
    Gradle gradle = getGradle()
    String args = gradle.getStartParameter().getTaskRequests().toString()
    println(args)
    if (args.contains("assembleRelease")) {
        return "Release"
    } else if (args.contains("assembleDebug")) {
        return "Debug"
    }
    return "Debug"
}